---
title: "Prediction-Assignment"
author: "Seanshir"
date: "September 15, 2017"
output: 
  github_document:
   toc: true
   toc_depth: 2
    ---

Summary

The goal of this project is to predict the manner in which users of exercise devices exercise by using machine learning algorithms.

The following data are provided:

Training data:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

Test data:

https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

Set the work environment and required libraries.

```{r results='hide',message=FALSE, warning=FALSE}

rm(list=ls())                

library(knitr)
library(caret)
library(rpart)
library(rpart.plot)
library(rattle)
library(randomForest)
set.seed(12345)
```
Load and prepare the data

```{r}


# download the datasets
training <- read.csv('pml-training.csv')
testing  <- read.csv('pml-testing.csv')

#Remove the ID columns for testing and training dataset
testing <- testing[,-c(1,160)]
training <- training[,-1]

#To have the same type of predictors in training and testing dataset and avoid the error with randomForest predict
testing <- rbind(training[1,-159],testing)
testing <- testing[-1,]
```

create a partition with the training dataset 
```{r }
inTrain  <- createDataPartition(training$classe, p=0.7, list=FALSE)
TrainSet <- training[inTrain, ]
TestSet  <- training[-inTrain, ]
dim(TrainSet)
dim(TestSet)
```
Data Cleaning

We remove columns(Variables) that have less than 60% of data entered.
``` {r }
# remove variables with Nearly Zero Variance
NZV <- nearZeroVar(TrainSet)
TrainSet <- TrainSet[, -NZV]
TestSet  <- TestSet[, -NZV]
dim(TrainSet)
dim(TestSet)

# remove variables that are mostly NA
AllNA    <- sapply(TrainSet, function(x) mean(is.na(x))) > 0.95
TrainSet <- TrainSet[, AllNA==FALSE]
TestSet  <- TestSet[, AllNA==FALSE]

dim(TrainSet)
dim(TestSet)
```
Prediction Modeling

Random Forests is chosen as it usually provides the most accurate predictions.
```{r}
model <- randomForest(classe ~ ., data=TrainSet)

```
Prediction on Testset data

```{r}
predictRandForest <- predict(model, newdata=TestSet)
confusionMatrix(predictRandForest, TestSet$classe)
```
Model Test

Finally, we predict the new values in the testing dataset provided, first we apply the same data cleaning operations on it and coerce all columns of testing data set for the same class of previous data set.

```{r}
# Keep the same columns of testing dataset
#NZVt <- nearZeroVar(testing)
#testing <- testing[, -NZVt]

#AllNAt  <- sapply(testing, function(x) mean(is.na(x))) > 0.95
#testing <- testing[, AllNAt==FALSE]

```

Prediction with testing dataset

```{r}
predictions <- predict(model,newdata=testing)
print(predictions)
```
